#!/bin/bash

if (( $EUID == 1 )); then

echo "Please use root user or sudo ./install.sh under your non-root account"
exit
else
echo "Running H1emu.com Private Server installer"
apt update && apt upgrade -y
apt install nodejs npm git net-tools software-properties-common nano node-typescript -y
apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4
add-apt-repository 'deb [arch=amd64] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse' -y
apt install mongodb-org -y
systemctl start mongod
systemctl enable mongod
echo "Installing MongoDB Web GUI"
npm i pm2 -g
npm i -g mongo-gui
pm2 kill
pm2 start mongo-gui
npm cache clean -f
npm install -g n
n stable
hash -r
git clone https://github.com/QuentinGruber/h1z1-server.git
cd h1z1-server
npm install
export NODE_ENV="production"
export DEBUG="ZoneServer"
export CLIENT_SIXTEEN="true"
export WORLD_ID="2"
export LOGINSERVER_IP="127.0.0.1"
export MONGO_URL="mongodb://localhost:27017/"
pm2 start docker/2016/zoneServer.js --watch
export DEBUG="*"
pm2 start docker/2015/loginServer.js --watch
pm2 startup
echo 'export DEBUG="ZoneServer"' >> start.sh
echo 'export CLIENT_SIXTEEN="true"' >> start.sh
echo 'export WORLD_ID="2"' >> start.sh
echo 'export LOGINSERVER_IP="127.0.0.1"' >> start.sh
echo 'export MONGO_URL="mongodb://localhost:27017/"' >> start.sh
echo 'pm2 kill' >> start.sh
echo 'pm2 start mongo-gui' >> start.sh
echo 'pm2 start docker/2016/zoneServer.js --watch' >> start.sh
echo 'pm2 start docker/2015/loginServer.js --watch' >> start.sh
echo 'export DEBUG="*"' >> start.sh
echo 'pm2 startup' >> start.sh
echo 'sleep 5' >> start.sh
chmod +x start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "****************██╗░░██╗░░███╗░░███████╗███╗░░░███╗██╗░░░██╗**********************************" ' >> start.sh
echo 'echo "****************██║░░██║░████║░░██╔════╝████╗░████║██║░░░██║**********************************" ' >> start.sh
echo 'echo "****************███████║██╔██║░░█████╗░░██╔████╔██║██║░░░██║**********************************" ' >> start.sh
echo 'echo "****************██╔══██║╚═╝██║░░██╔══╝░░██║╚██╔╝██║██║░░░██║**********************************" ' >> start.sh
echo 'echo "****************██║░░██║███████╗███████╗██║░╚═╝░██║╚██████╔╝**********************************" ' >> start.sh
echo 'echo "****************╚═╝░░╚═╝╚══════╝╚══════╝╚═╝░░░░░╚═╝░╚═════╝░**********************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "****************Access your MongoDB with http://SERVERIP:4321/ *******************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "****************To Connect to server with Game client SERVERIP:1115***************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "****************Use (pm2 kill) to stop server*************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "****************Use (./start.sh) to start server**********************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "****************Your H1emu Server Should now be running***************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh
echo 'echo "**********************************************************************************************" ' >> start.sh

sleep 5

echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "****************██╗░░██╗░░███╗░░███████╗███╗░░░███╗██╗░░░██╗**********************************" 
echo "****************██║░░██║░████║░░██╔════╝████╗░████║██║░░░██║**********************************" 
echo "****************███████║██╔██║░░█████╗░░██╔████╔██║██║░░░██║**********************************" 
echo "****************██╔══██║╚═╝██║░░██╔══╝░░██║╚██╔╝██║██║░░░██║**********************************" 
echo "****************██║░░██║███████╗███████╗██║░╚═╝░██║╚██████╔╝**********************************" 
echo "****************╚═╝░░╚═╝╚══════╝╚══════╝╚═╝░░░░░╚═╝░╚═════╝░**********************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "****************Access your MongoDB with http://SERVERIP:4321/ *******************************" 
echo "**********************************************************************************************" 
echo "****************To Connect to server with Game client SERVERIP:1115***************************" 
echo "**********************************************************************************************" 
echo "****************Use (pm2 kill) to stop server*************************************************" 
echo "**********************************************************************************************"
echo "****************Use (pm2 log) to monitor******************************************************"
echo "**********************************************************************************************"
echo "****************Use (./start.sh) to start server**********************************************" 
echo "**********************************************************************************************" 
echo "****************Your H1emu Server Should now be running***************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************" 
echo "**********************************************************************************************"
fi
